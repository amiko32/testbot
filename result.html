<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #f5f5f5;
      font-family: "Segoe UI", sans-serif;
      color: #2c2c2c;
    }
    .card {
      border: none;
      border-radius: 16px;
      background: #ffffff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    h1, h5 {
      color: #3e3e3e;
    }
    .correct { color: #5a8a57; font-weight: 600; }
    .incorrect { color: #d9534f; font-weight: 600; }
    .muted { color: #888; font-size: 0.9rem; }
    .badge {
      border-radius: 12px;
      padding: 6px 10px;
      font-size: 0.85rem;
    }
    .bg-success { background-color: #a6c48a !important; }
    .bg-danger { background-color: #e28f83 !important; }
    .bg-secondary { background-color: #d4b483 !important; }
    .progress {
      background-color: #e6dfd8;
      border-radius: 12px;
      height: 25px;
    }
    .progress-bar {
      border-radius: 12px;
      background-color: #a67c52;
      font-weight: 600;
      font-size: 14px;
    }
    .btn {
      border-radius: 12px;
      padding: 8px 18px;
      font-weight: 500;
    }
    .btn-primary {
      background-color: #a67c52;
      border: none;
    }
    .btn-primary:hover {
      background-color: #8c6544;
    }
    .btn-secondary {
      background-color: #c4c7a3;
      border: none;
    }
    .btn-secondary:hover {
      background-color: #a6a98a;
    }
  </style>
</head>
<body>
<div class="container py-5">
  <div class="card p-4 text-center mb-4">
    <h1>üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞</h1>
    <p>–ë–∞–ª–ª–æ–≤ (—á–∞—Å—Ç–∏—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞): <strong>{{ score }}</strong> –∏–∑ <strong>{{ total }}</strong></p>
    <h5>–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤: 
      <span class="badge bg-success">{{ full_correct_count }}</span> 
      –∏–∑ <span class="badge bg-secondary">{{ total }}</span>
    </h5>
    <p class="mt-2">
      ‚úîÔ∏è <span class="correct">{{ total_true }}</span> –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ |
      ‚ùå <span class="incorrect">{{ total_false }}</span> –æ—à–∏–±–æ–∫ |
      ‚è≠ <span>{{ total_missed }}</span> –ø—Ä–æ–ø—É—â–µ–Ω–æ
    </p>
    <div class="progress mt-3">
      <div class="progress-bar" role="progressbar" style="width: {{ percent }}%;">
        {{ percent }}% –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
      </div>
    </div>
  </div>

  {% for r in results %}
    <div class="card mb-3">
      <div class="card-body">
        <h5>–í–æ–ø—Ä–æ—Å {{ loop.index }}: {{ r.question }}</h5>

        <p><strong>–í–∞—à –æ—Ç–≤–µ—Ç:</strong>
          {% if r.type == "choice" %}
            {% if r.your_answer and r.your_answer != "‚Äî" %}
              {% for a in r.your_answer %}
                {% if a in r.correct_answer %}
                  <span class="correct">{{ a }}</span>
                {% else %}
                  <span class="incorrect">{{ a }}</span>
                {% endif %}
                {% if not loop.last %}, {% endif %}
              {% endfor %}
            {% else %}
              ‚Äî –Ω–µ –æ—Ç–º–µ—á–µ–Ω–æ
            {% endif %}
          {% else %}
            {{ r.your_answer }}
          {% endif %}
        </p>

        <p><strong>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π(–µ) –≤–∞—Ä–∏–∞–Ω—Ç(—ã):</strong>
          {% for a in r.correct_answer %}
            <span class="correct">{{ a }}</span>{% if not loop.last %}, {% endif %}
          {% endfor %}
        </p>

        <p>‚úîÔ∏è –û—Ç–º–µ—á–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: <span class="correct">{{ r.true_pos }}</span> |
           ‚ùå –û—à–∏–±–æ—á–Ω–æ: <span class="incorrect">{{ r.false_pos }}</span> |
           ‚è≠ –ü—Ä–æ–ø—É—â–µ–Ω–æ: <span>{{ r.missed }}</span>
        </p>

        {% if r.is_fully_correct %}
          <span class="badge bg-success">‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–∞–≤–∏–ª—å–Ω–æ</span>
        {% else %}
          <span class="badge bg-danger">‚ùå –ù–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–µ—Ä–Ω–æ</span>
        {% endif %}
      </div>
    </div>
  {% endfor %}

  <div class="text-center mt-4">
    {% if session.role == 'teacher' %}
      <a href="{{ url_for('stats') }}" class="btn btn-primary">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
      <a href="{{ url_for('admin') }}" class="btn btn-secondary">üìù –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç</a>
    {% endif %}
    <a href="{{ url_for('test_page') }}" class="btn btn-primary ms-2">üîÑ –ü—Ä–æ–π—Ç–∏ –µ—â—ë —Ä–∞–∑</a>
  </div>
</div>
</body>
</html>