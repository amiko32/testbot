<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–¢–µ—Å—Ç</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #f5f5f5;
      font-family: "Segoe UI", sans-serif;
      color: #2c2c2c;
    }
    .card {
      border: none;
      border-radius: 16px;
      background: #ffffff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    h1 {
      color: #3e3e3e;
    }
    p b {
      color: #444;
    }
    .form-check-input {
      border-radius: 6px;
      border: 1px solid #ccc;
      cursor: pointer;
    }
    .form-check-input:checked {
      background-color: #a67c52;
      border-color: #a67c52;
    }
    .form-check-label {
      cursor: pointer;
    }
    .form-control {
      border-radius: 12px;
      border: 1px solid #ddd;
      padding: 10px 12px;
      transition: all 0.2s;
    }
    .form-control:focus {
      border-color: #a67c52;
      box-shadow: 0 0 0 0.2rem rgba(166, 124, 82, 0.25);
    }
    .btn-success {
      background-color: #a67c52;
      border: none;
      border-radius: 12px;
      padding: 10px;
      font-weight: 500;
    }
    .btn-success:hover {
      background-color: #8c6544;
    }
    hr {
      border-top: 1px solid #eee;
    }
    .timer {
      background: #ff6b6b;
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: bold;
      font-size: 1.2em;
      margin-bottom: 20px;
      display: inline-block;
    }
    .timer-warning {
      background: #ff9f43;
      animation: pulse 1s infinite;
    }
    .timer-critical {
      background: #ee5a52;
      animation: pulse 0.5s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body>

<div class="container py-5">
  <div class="card shadow-lg p-4">
    <div class="text-center mb-4">
      <h1>üìö –ü—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç</h1>
      <div class="timer" id="timer">30:00</div>
      <div id="timerMessage"></div>
    </div>

    <form method="POST" id="testForm">
      {% for q in test %}
        <div class="mb-4">
          <p><b>–í–æ–ø—Ä–æ—Å {{ loop.index }}:</b> {{ q.question }}</p>
          
          {% if q.type == "choice" %}
            {% set q_index = loop.index0 %}
            {% for option in q.options %}
              <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" 
                       name="q{{ q_index }}" 
                       value="{{ option }}" 
                       id="q{{ q_index }}_{{ loop.index }}">
                <label class="form-check-label" for="q{{ q_index }}_{{ loop.index }}">
                  {{ option }}
                </label>
              </div>
            {% endfor %}
          
          {% elif q.type == "text" %}
            <input type="text" class="form-control" name="q{{ loop.index0 }}" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç" required>
          {% endif %}
        </div>
        <hr>
      {% endfor %}

      <button type="submit" class="btn btn-success w-100 mt-3">–û—Ç–ø—Ä–∞–≤–∏—Ç—å ‚úÖ</button>
    </form>
  </div>
</div>

<script>
// –¢–∞–π–º–µ—Ä –Ω–∞ 30 –º–∏–Ω—É—Ç
let timeLeft = 30 * 60; // 30 –º–∏–Ω—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
const timerElement = document.getElementById('timer');
const timerMessage = document.getElementById('timerMessage');
const testForm = document.getElementById('testForm');

function updateTimer() {
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    
    // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª—è –ø—Ä–∏ –º–∞–ª–æ–º –≤—Ä–µ–º–µ–Ω–∏
    timerElement.classList.remove('timer-warning', 'timer-critical');
    if (timeLeft <= 300) { // 5 –º–∏–Ω—É—Ç
        timerElement.classList.add('timer-critical');
        timerMessage.innerHTML = '<div class="alert alert-danger mt-2">‚è∞ –í—Ä–µ–º—è –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è! –ü–æ—Å–ø–µ—à–∏—Ç–µ!</div>';
    } else if (timeLeft <= 600) { // 10 –º–∏–Ω—É—Ç
        timerElement.classList.add('timer-warning');
        timerMessage.innerHTML = '<div class="alert alert-warning mt-2">‚è≥ –û—Å—Ç–∞–ª–æ—Å—å –º–µ–Ω—å—à–µ 10 –º–∏–Ω—É—Ç</div>';
    }
    
    if (timeLeft <= 0) {
        clearInterval(timerInterval);
        timerElement.textContent = "00:00";
        timerMessage.innerHTML = '<div class="alert alert-danger mt-2">‚è∞ –í—Ä–µ–º—è –≤—ã—à–ª–æ! –¢–µ—Å—Ç –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.</div>';
        testForm.submit();
    }
    
    timeLeft--;
}

const timerInterval = setInterval(updateTimer, 1000);

// –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('beforeunload', function (e) {
    if (timeLeft > 0) {
        e.preventDefault();
        e.returnValue = '–¢–µ—Å—Ç –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω. –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∫–∏–Ω—É—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É?';
    }
});
</script>

</body>
</html>